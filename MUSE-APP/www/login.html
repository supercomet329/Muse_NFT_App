<!doctype html>
<html lang="ja">

<head>
    <title>Muse | ログイン</title>
    <!-- Required meta tags -->
    <meta name="viewport"
        content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <meta charset="utf-8">
    <!-- Icon -->
    <link rel="shortcut icon" href="assets/img/icon/logo.png">
    <link rel="apple-touch-icon" href="assets/img/icon/logo.png">
    <!-- Main CSS -->
    <link rel="stylesheet" type="text/css" href="assets/css/style.css">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="assets/css/all.min.css">
    <!-- Optional JavaScript -->
    <!-- jQuery -->
    <script src="assets/js/jquery-3.6.0.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="assets/js/bootstrap.bundle.min.js"></script>
    <!-- Javascript(js/muse.js)読み込み -->
    <script type="text/javascript" src="js/muse.js"></script>
    <!-- Javascript(js/validate.js)読み込み -->
    <script type="text/javascript" src="js/validate.js"></script>
</head>

<body>
    <header class="popular_artist">
        <nav class="fixed-top navbar navbar-light bg-light">
            <a href="profile.html"><img src="assets/img/icon/profile.jpg" alt="profile" class="rounded-circle"></a>
            <a href="picture_mode.html"><img src="assets/img/icon/logo.png" alt="logo"></a>
            <div><img src="assets/img/icon/picture_blue.png" alt="change" data-toggle="modal" class="change-logo"></div>
        </nav>
    </header>

    <div class="pt-sm-5 mt-sm-5">
        <div class="container pt-5">
            <form>
                <div class="row">
                    <div class="col-12">
                        <h1 class="text-center mb-4 contents-title font-weight-bold">ログイン</h1>
                    </div>
                    <div class="col-12">
                        <label for="email" class="label-text">メールアドレス</label>
                    </div>
                    <div class="col-12 pt-2 pb-2">
                        <input class="form-control email-form" type="email" name="loginEmail" id="loginEmail" placeholder="aaaa@muse.co.jp">
                    </div>
                    <div class="col-12">
                        <label for="loginPassword" class="label-text">パスワード</label>
                    </div>
                    <div class="col-12 pt-2 pb-2">
                        <input class="form-control email-form" type="password" name="loginPassword" id="loginPassword" placeholder="Musepass1">
                    </div>
                    <div class="col-12 reset-password text-center">
                        <a href="pass_reset.html" class="reset-password-link">&gt;&gt;パスワードを忘れた場合はこちら</a>
                    </div>
                    <div class="col-12 text-center pt-2">
                        <button type="submit" class="btn btn-primary text-white submit-btn" id="login-btn" disabled>ログイン</button>
                    </div>
                    <div class="col-12 text-center pt-3">
                        <input class="form-check-input" type="checkbox" value="1" id="remember" name="remember">
                        <label class="form-check-label terms-check pb-2" for="remember">
                            <p class="remember">ログイン情報を記憶する</p>
                        </label>
                    </div>
                </div>
            </form>
            <hr class="hr-line">
            <div class="row">
                <div class="col-12">
                    <h1 class="text-center mt-3 mb-3 contents-title font-weight-bold">SNSログイン</h1>
                </div>
                <div class="col-12 login-with-sns">
                    <button class="twitter-btn" id="twitter_btn">
                        <img src="assets/img/icon/twitter_icon.png" alt="twitter" class="twitter-icon">
                        Twitterでログインする
                    </button>
                </div>
                <div class="col-12 login-with-sns mt-3">
                    <button class="google-btn" id="google_btn">
                        <img src="assets/img/icon/g-logo.png" alt="google" class="google-icon">
                        Googleアカウントでログインする
                    </button>
                </div>
            </div>
            <hr class="hr-line mt-3">
            <div class="row">
                <div class="col-12">
                    <h1 class="text-center mt-3 mb-3 contents-title font-weight-bold">新規会員登録</h1>
                </div>
                <div class="col-12 register-notes">
                    <p class="register-notes-text text-center">
                        会員ではない方は会員登録してください
                    </p>
                </div>
                <div class="col-12 text-center pt-1">
                    <a href="sign_up.html">
                        <button type="button" class="btn btn-primary text-white submit-btn">新規会員登録はこちら</button>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <nav class="navbar navbar-light bg-light fixed-bottom">
            <a href="normal_mode.html"><img src="assets/img/icon/home_blue_on.png" alt="home"></a>
            <a href="search.html"><img src="assets/img/icon/search_blue.png" alt="search"></a>
            <a href="post.html"><img src="assets/img/icon/post_blue.png" alt="post"></a>
            <div class="notifications">
                <a href="notification.html"><img src="assets/img/icon/notification_blue.png" alt="notification"></a>
                <p class="unread-count rounded-circle">2000</p>
            </div>
            <div class="messages">
                <a href="message.html"><img src="assets/img/icon/message_blue.png" alt="message"></a>
                <p class="unread-count top-left rounded-circle">2000</p>
            </div>
        </nav>
    </footer>

</body>

<script>

    $(function () {
        // エンドポイントの定義
        const baseUrl = "http://localhost:3000/api";
        // ログインボタン押下時のイベント
        $('#login-btn').on('click', function() {
            // サブミットイベントを無効化
            event.preventDefault();
            // ログイン情報を取得
            let email = $('#loginEmail').val();
            let password = $('#loginPassword').val();
            const apiType = "login";
            // ログインを実行
            login(email, password, apiType);
        })

        $('#twitter_btn').on('click', function() {
            // ログイン情報を取得
            const apiType = "twitter_login";
            // ログインを実行
            twitterLogin(apiType);
        })

        $('#google_btn').on('click', function() {
            // ログイン情報を取得
            const apiType = "google_login";
            // ログインを実行
            googleLogin(apiType);
        })

        // ログインAPIのエンドポイントにAjaxする
        function login (email, password, apiType) {
            $.ajax({
                url: baseUrl,
                type: "POST",
                data:{
                    "email": email,
                    "password": password,
                    "api_type": apiType,
                },
            }).done(function(data) {
                // Ajaxで取得した値をローカルストレージに保存
                localStorage.setItem('token', data.token);
                console.log(data.result);
                return data.result;
            }).fail(function(data) {
                console.log('Ajax fail (communication error)');
                return false;
            });
        }

        // TwitterでログインAPIのエンドポイントにAjaxする
        function twitterLogin (apiType) {
            $.ajax({
                url: baseUrl,
                type: "POST",
                data:{
                    "api_type": apiType,
                },
            }).done(function(data) {
                // Ajaxで取得した値をローカルストレージに保存
                localStorage.setItem('token', data.token);
                console.log(data.result);
                return data.result;
            }).fail(function(data) {
                console.log('Ajax fail (communication error)');
                return false;
            });
        }

        // GoogleでログインAPIのエンドポイントにAjaxする
        function googleLogin (apiType) {
            $.ajax({
                url: baseUrl,
                type: "POST",
                data:{
                    "api_type": apiType,
                },
            }).done(function(data) {
                // Ajaxで取得した値をローカルストレージに保存
                localStorage.setItem('token', data.token);
                console.log(data.result);
                return data.result;
            }).fail(function(data) {
                console.log('Ajax fail (communication error)');
                return false;
            });
        }

    });
</script>

</html>
